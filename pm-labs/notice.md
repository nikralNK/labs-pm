# Лабораторная работа 24: MenuStrip, TabControl и табулирование функции

## Описание работы программы

Приложение для табулирования кусочно-заданной функции с визуализацией результатов в виде таблицы и графика. Реализовано операционное меню для управления и настройки внешнего вида.

## Функция

```
y = x^5 * ctg(2*x^3),        если x <= 0
y = 5 / (tan(2*x + 3) + 1),  если 0 < x <= 5
y = x^2 * exp(-x),           если x > 5
```

Параметры по умолчанию:
- Xn = -1,6
- Xk = 3,7
- Xh = 0,7
- a = 1

## Структура приложения

### MenuStrip

Главное меню содержит три пункта:

**Файл:**
- Сохранить данные таблицы в файл - экспорт результатов в текстовый файл
- Выход - завершение работы приложения

**Вид:**
- Таблица:
  - Цвет текста - настройка цвета текста в DataGridView
  - Цвет фона - настройка цвета фона ячеек
  - Цвет сетки - настройка цвета линий сетки
- График:
  - Цвет линии графика - настройка цвета линии на графике
  - Цвет фона графика - настройка цвета фона области графика

**Выход** - завершение работы приложения

### TabControl

Приложение содержит три вкладки:

#### Вкладка 1: Ввод данных

Содержит поля для ввода параметров:
- **txtXn** - начальное значение интервала
- **txtXk** - конечное значение интервала
- **txtXh** - шаг табулирования
- **txtA** - параметр функции (не используется в данной функции)

Также отображается формула функции для справки.

#### Вкладка 2: Таблица данных

Содержит:
- **dgvResults** - DataGridView с двумя столбцами (X, Y)
- **txtYmax** - текстовое поле для отображения максимального значения Y
- **txtYmin** - текстовое поле для отображения минимального значения Y

При переключении на эту вкладку автоматически генерируется таблица значений.

#### Вкладка 3: График функции

Содержит:
- **chart1** - компонент Chart для отображения графика функции

При переключении на эту вкладку автоматически строится график.

## Основные методы

### CalculateFunction(double x)

Вычисляет значение функции в точке x согласно кусочному определению:

```csharp
if (x <= 0)
    return Math.Pow(x, 5) * (1 / Math.Tan(2 * Math.Pow(x, 3)));
else if (x > 0 && x <= 5)
    return 5 / (Math.Tan(2 * x + 3) + 1);
else
    return Math.Pow(x, 2) * Math.Exp(-x);
```

### tabControl1_SelectedIndexChanged

Обрабатывает переключение между вкладками:
- При выборе вкладки 1 (индекс 1) - вызывается GenerateTable()
- При выборе вкладки 2 (индекс 2) - вызывается GenerateChart()

### GenerateTable()

Генерирует таблицу значений функции:

1. Валидирует входные данные через ValidateInputs()
2. Очищает dgvResults.Rows
3. Инициализирует переменные для поиска экстремумов
4. В цикле while (x <= xk):
   - Вычисляет y = CalculateFunction(x)
   - Добавляет строку в таблицу
   - Обновляет ymax и ymin
   - Увеличивает x на xh
5. Выводит экстремумы в txtYmax и txtYmin
6. Применяет цветовую схему через ApplyTableColors()

### GenerateChart()

Строит график функции:

1. Валидирует входные данные
2. Очищает точки серии: chart1.Series[0].Points.Clear()
3. В цикле while (x <= xk):
   - Вычисляет y = CalculateFunction(x)
   - Добавляет точку: chart1.Series[0].Points.AddXY(x, y)
   - Увеличивает x на xh
4. Применяет цветовую схему через ApplyChartColors()

### ValidateInputs()

Проверяет корректность введенных данных:

1. Парсит txtXn через TryParseDouble()
2. Парсит txtXk
3. Парсит txtXh и проверяет xh > 0
4. Парсит txtA
5. Проверяет xn < xk
6. При ошибке показывает MessageBox и переключается на вкладку 0

Возвращает true если все проверки пройдены.

### TryParseDouble(string text, out double result)

Парсит строку в double с учетом разных региональных настроек:
```csharp
text = text.Replace(',', '.');
return double.TryParse(text, NumberStyles.Any, CultureInfo.InvariantCulture, out result);
```

### ValidateNumberInput(object sender, KeyPressEventArgs e)

Валидация ввода в реальном времени для TextBox:

1. Пропускает управляющие клавиши (Backspace, Delete, etc.)
2. Для '+' и '-':
   - Разрешает только в начале строки
   - Только один знак
3. Для ',' и '.':
   - Только один разделитель
   - Не в начале строки
4. Остальные символы - только цифры

### ApplyTableColors()

Применяет цветовую схему к таблице:
```csharp
dgvResults.DefaultCellStyle.ForeColor = dgvForeColor;
dgvResults.DefaultCellStyle.BackColor = dgvBackColor;
dgvResults.GridColor = dgvGridColor;
```

### ApplyChartColors()

Применяет цветовую схему к графику:
```csharp
chart1.Series[0].Color = chartLineColor;
chart1.ChartAreas[0].BackColor = chartBackColor;
```

## Form2 - Настройки цвета

Вспомогательная форма для выбора цвета.

### Свойства

- **SettingType** - тип настройки (TableForeColor, TableBackColor, TableGridColor, ChartLineColor, ChartBackColor)

### Методы

**Form2_Load:**
- Устанавливает заголовок в зависимости от SettingType
- Загружает текущий цвет из статических полей Form1
- Отображает предпросмотр в panelPreview

**btnChooseColor_Click:**
- Открывает ColorDialog
- Обновляет panelPreview выбранным цветом

**btnOK_Click:**
- Сохраняет выбранный цвет в соответствующее статическое поле Form1
- Закрывает форму с DialogResult.OK

## Сохранение в файл

При выборе "Файл → Сохранить данные таблицы в файл":

1. Проверяется наличие данных в таблице
2. Открывается SaveFileDialog
3. Создается файл через StreamWriter
4. Записывается заголовок "X\t\tY"
5. Записываются все строки таблицы
6. Записываются значения Ymax и Ymin

Формат файла:
```
X		Y
--------------------------------------------------
-1,6000		-0,000001
-0,9000		0,123456
...
--------------------------------------------------
Ymax: 5.234567
Ymin: -0.123456
```

## Статические поля Form1

Используются для хранения настроек между формами:

- **dgvForeColor** - цвет текста таблицы (по умолчанию Black)
- **dgvBackColor** - цвет фона таблицы (по умолчанию White)
- **dgvGridColor** - цвет сетки таблицы (по умолчанию Black)
- **chartLineColor** - цвет линии графика (по умолчанию Blue)
- **chartBackColor** - цвет фона графика (по умолчанию White)

## Особенности реализации

1. **Автоматическая генерация** - таблица и график генерируются автоматически при переключении вкладок
2. **Валидация ввода** - проверка в реальном времени через KeyPress и при генерации
3. **Кусочно-заданная функция** - три различных формулы в зависимости от диапазона x
4. **Поиск экстремумов** - автоматическое определение Ymax и Ymin
5. **Настройка цветов** - отдельная форма для выбора цветов с предпросмотром
6. **Экспорт данных** - сохранение таблицы в текстовый файл с форматированием
7. **Chart.Spline** - сглаженная линия графика для лучшей визуализации
8. **FixedToolWindow** - диалоговое окно фиксированного размера
